<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AB Fit - Assessoria de Treinamento</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ef4444">
    <link rel="manifest" href="data:application/manifest+json,{
        &quot;name&quot;: &quot;AB Fit&quot;,
        &quot;short_name&quot;: &quot;AB Fit&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#ffffff&quot;,
        &quot;theme_color&quot;: &quot;#ef4444&quot;,
        &quot;description&quot;: &quot;Assessoria de Treinamento Físico por André Brito.&quot;,
        &quot;icons&quot;: [
            { &quot;src&quot;: &quot;https://placehold.co/192x192/ef4444/ffffff?text=AB&quot;, &quot;sizes&quot;: &quot;192x192&quot;, &quot;type&quot;: &quot;image/png&quot; },
            { &quot;src&quot;: &quot;https://placehold.co/512x512/ef4444/ffffff?text=AB&quot;, &quot;sizes&quot;: &quot;512x512&quot;, &quot;type&quot;: &quot;image/png&quot; }
        ]
    }">

    <!-- iOS PWA Meta Tags for Native App Feel -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AB Fit">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/ef4444/ffffff?text=AB">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .screen { display: none; }
        .screen.active { display: block; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ef4444;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto max-w-4xl">
        <main class="h-full w-full bg-gray-50 min-h-screen">

            <!-- ======================= TELA LISTA DE ALUNOS ======================= -->
            <div id="studentListScreen" class="screen">
                 <div class="p-4 md:p-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Menu Principal</h1>
                    <div class="bg-gradient-to-r from-red-500 to-red-700 text-white p-5 rounded-lg mb-6 shadow-lg">
                        <div class="flex items-center mb-2">
                             <i data-feather="star" class="w-5 h-5 mr-2"></i>
                            <h3 class="font-bold text-lg">✨ Dica do Dia</h3>
                        </div>
                        <p id="daily-tip" class="text-sm">Carregando dica...</p>
                    </div>
                    <div class="relative mb-6">
                        <input type="text" placeholder="Procurar aluno..." class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white">
                        <i data-feather="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <div id="student-list-container" class="space-y-3"></div>
                </div>
            </div>

            <!-- ======================= TELA PERFIL DO ALUNO ======================= -->
            <div id="studentProfileScreen" class="screen">
                 <div class="p-4 md:p-8 space-y-4 relative">
                    <button class="back-to-list-btn p-2 rounded-full hover:bg-gray-200 absolute top-6 left-4 md:top-8 md:left-6">
                        <i data-feather="arrow-left" class="text-gray-700"></i>
                    </button>
                    <div id="student-profile-info" class="flex items-center pt-12 md:pt-8 mb-4">
                        <!-- Student info will be populated by JS -->
                    </div>
                    <button id="openAiModalBtn" class="w-full bg-gray-800 text-white font-bold py-3 rounded-lg hover:bg-gray-900 transition-colors shadow-md flex items-center justify-center">
                       ✨ Gerar Treino com IA
                    </button>
                    <div id="student-profile-buttons" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 mt-4">
                        <div id="calendar-header" class="flex justify-between items-center mb-4">
                            <button class="p-2 rounded-full hover:bg-gray-100"><i data-feather="chevron-left"></i></button>
                            <h2 class="font-bold text-lg text-gray-800">Setembro 2025</h2>
                            <button class="p-2 rounded-full hover:bg-gray-100"><i data-feather="chevron-right"></i></button>
                        </div>
                        <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
                    </div>
                </div>
            </div>
            
            <!-- ======================= TELA DE TREINO ======================= -->
            <div id="trainingScreen" class="screen">
                 <div class="p-4 md:p-8 relative">
                    <button class="back-to-profile-btn p-2 rounded-full hover:bg-gray-200 absolute top-6 left-4 md:top-8 md:left-6">
                        <i data-feather="arrow-left" class="text-gray-700"></i>
                    </button>
                    <div id="training-content-wrapper" class="pt-12 md:pt-8">
                        <!-- JS will populate this -->
                    </div>
                </div>
            </div>

            <!-- ======================= TELA DE EVOLUÇÃO (GRÁFICOS) ======================= -->
            <div id="evolutionScreen" class="screen">
                 <div class="p-4 md:p-8 relative">
                    <button class="back-to-profile-btn p-2 rounded-full hover:bg-gray-200 absolute top-6 left-4 md:top-8 md:left-6">
                        <i data-feather="arrow-left" class="text-gray-700"></i>
                    </button>
                    <div class="pt-12 md:pt-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Evolução de Carga</h1>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 mb-6">
                            <h2 class="text-xl font-bold text-gray-700 mb-4">Treino A</h2>
                            <canvas id="treinoAChart"></canvas>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <h2 class="text-xl font-bold text-gray-700 mb-4">Treino B</h2>
                            <canvas id="treinoBChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ======================= TELA TREINOS DE CORRIDA ======================= -->
            <div id="runningWorkoutsScreen" class="screen">
                 <div class="p-4 md:p-8 relative">
                    <button class="back-to-profile-btn p-2 rounded-full hover:bg-gray-200 absolute top-6 left-4 md:top-8 md:left-6">
                        <i data-feather="arrow-left" class="text-gray-700"></i>
                    </button>
                    <div class="pt-12 md:pt-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Treinos de Corrida</h1>
                        <div id="running-workouts-list" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= TELA PERIODIZAÇÃO ======================= -->
            <div id="periodizationScreen" class="screen">
                 <div class="p-4 md:p-8 relative">
                    <button class="back-to-profile-btn p-2 rounded-full hover:bg-gray-200 absolute top-6 left-4 md:top-8 md:left-6">
                        <i data-feather="arrow-left" class="text-gray-700"></i>
                    </button>
                    <div class="pt-12 md:pt-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Periodização</h1>
                        <div id="periodization-list" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= TELA CONTROLE DE PESO ======================= -->
            <div id="weightControlScreen" class="screen">
                 <div class="p-4 md:p-8 relative">
                    <button class="back-to-profile-btn p-2 rounded-full hover:bg-gray-200 absolute top-6 left-4 md:top-8 md:left-6">
                        <i data-feather="arrow-left" class="text-gray-700"></i>
                    </button>
                    <div class="pt-12 md:pt-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Controle de Peso</h1>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 mb-6">
                            <h2 class="text-xl font-bold text-gray-700 mb-4">Adicionar Novo Registro</h2>
                            <div class="flex items-center gap-2">
                                <input type="number" step="0.1" id="weight-input" placeholder="Ex: 85.5" class="w-full p-3 border border-gray-300 rounded-lg">
                                <span class="font-semibold text-gray-600">kg</span>
                                <button id="save-weight-btn" class="bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700 transition-colors">Salvar</button>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 mb-6">
                            <h2 class="text-xl font-bold text-gray-700 mb-4">Evolução do Peso</h2>
                            <canvas id="weightChart"></canvas>
                        </div>
                         <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <h2 class="text-xl font-bold text-gray-700 mb-4">Histórico de Peso</h2>
                            <div id="weight-history-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
        
        <!-- ======================= MODAIS ======================= -->
        <div id="aiGeneratorModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
            <!-- Conteúdo do Modal IA -->
        </div>
        <div id="exerciseDetailModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6 relative transform transition-all duration-300 scale-95 opacity-0" id="exercise-modal-content">
                <button id="closeExerciseModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
                <div id="exercise-modal-body"></div>
            </div>
        </div>
        <div id="runningLogModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6 relative transform transition-all duration-300 scale-95 opacity-0" id="running-modal-content">
                <button id="closeRunningLogModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i data-feather="x"></i></button>
                <div id="running-log-modal-body"></div>
            </div>
        </div>
    </div>

    <script type="module">
        function mainApp() {
            if (typeof feather !== 'undefined') {
                feather.replace();
            } else {
                console.error("Feather Icons não carregou.");
            }

            const database = {
                 users: [
                    { id: 1, name: 'André Brito', email: 'britodeandrade@gmail.com', photo: 'https://storage.googleapis.com/glide-prod.appspot.com/uploads-v2/WsTwhcQeE99iAkUHmCmn/pub/3Zy4n6ZmWp9DW98VtXpO.jpeg' },
                    { id: 2, name: 'Marcelly Bispo', email: 'marcellybispo92@gmail.com', photo: 'https://storage.googleapis.com/glide-prod.appspot.com/uploads-v2/WsTwhcQeE99iAkUHmCmn/pub/2VWhNV4eSyDNkwEzPGvq.jpeg' },
                    { id: 3, name: 'Marcia Brito', email: 'andrademarcia.ucam@gmail.com', photo: 'https://storage.googleapis.com/glide-prod.appspot.com/uploads-v2/WsTwhcQeE99iAkUHmCmn/pub/huS3I3wDTHbXGY1EuLjf.jpg' },
                    { id: 4, name: 'Liliane Torres', email: 'lilicatorres@gmail.com', photo: 'https://i.ibb.co/7j6x0gG/liliane-torres.jpg' }
                ],
                trainingPlans: {},
                baseRunningWorkouts: [
                    { method: 'FARTLEK', details: "5' AQ + 20' CO alternado entre CA : CO + 5' REC", defaultSpeed: '8,5 Km/h', defaultPace: '7:00/Km' },
                    { method: 'INTERVALADO', details: "5' AQ + (6 BLOCOS) 2' CO : 1'30'' REC + 3' REC", defaultSpeed: '9,5 Km/h', defaultPace: '6:19/Km' },
                    { method: 'LONGÃO', details: "5' AQ + 3 KM DE CO CONTÍNUA + 5' REC", defaultSpeed: '8,5 Km/h', defaultPace: '7:04/Km' },
                    { method: 'RITMO', details: "5' AQ + (4 BLOCOS) 500 metros CO : 2'30'' REC + 3' REC", defaultSpeed: '9,5 Km/h', defaultPace: '6:19/Km' },
                    { method: 'TIROS', details: "5' AQ + (8 TIROS) 200 metros CO : 2'30 REC + 3' REC", defaultSpeed: '12 Km/h', defaultPace: '5:00/Km' }
                ]
            };

            let currentStudentId = null;

            function initializeDatabase() {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                
                // Inicializar dados de peso para demonstração
                database.trainingPlans['britodeandrade@gmail.com'] = {
                    weight: [
                        { date: '2025-09-20', value: 85.2 },
                        { date: '2025-09-22', value: 84.8 },
                        { date: '2025-09-24', value: 84.5 },
                        { date: today, value: 84.3 }
                    ]
                };
                
                database.trainingPlans["marcellybispo92@gmail.com"] = {
                    weight: [
                        { date: '2025-09-18', value: 62.5 },
                        { date: '2025-09-21', value: 62.2 },
                        { date: '2025-09-23', value: 62.0 },
                        { date: yesterday, value: 61.8 }
                    ],
                    runningWorkouts: [
                        { date: '2025-09-20', type: 'FARTLEK', distance: 5, duration: '00:30:00', avgPace: '6:00/km', completed: true },
                        { date: '2025-09-22', type: 'INTERVALADO', distance: 4, duration: '00:25:00', avgPace: '6:15/km', completed: false },
                        { date: '2025-09-24', type: 'LONGÃO', distance: 10, duration: '01:00:00', avgPace: '6:00/km', completed: true }
                    ],
                    periodization: [
                        { month: 'Setembro', year: 2025, focus: 'Resistência', details: 'Foco em treinos de longa duração e intervalados.' },
                        { month: 'Outubro', year: 2025, focus: 'Força', details: 'Foco em treinos de tiro e subidas.' }
                    ]
                };
            }

            function showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
            }

            function populateStudentList() {
                const container = document.getElementById('student-list-container');
                container.innerHTML = '';
                
                database.users.forEach(user => {
                    const studentCard = document.createElement('div');
                    studentCard.className = 'bg-white p-4 rounded-lg border border-gray-200 hover:shadow-md transition-shadow cursor-pointer';
                    studentCard.innerHTML = `
                        <div class="flex items-center">
                            <img src="${user.photo}" alt="${user.name}" class="w-12 h-12 rounded-full object-cover mr-4">
                            <div>
                                <h3 class="font-semibold text-gray-800">${user.name}</h3>
                                <p class="text-sm text-gray-600">${user.email}</p>
                            </div>
                        </div>
                    `;
                    studentCard.addEventListener('click', () => {
                        currentStudentId = user.id;
                        populateStudentProfile(user.id);
                        showScreen('studentProfileScreen');
                    });
                    container.appendChild(studentCard);
                });
            }

            function populateStudentProfile(userId) {
                const user = database.users.find(u => u.id === userId);
                if (!user) return;

                const profileInfo = document.getElementById('student-profile-info');
                profileInfo.innerHTML = `
                    <img src="${user.photo}" alt="${user.name}" class="w-16 h-16 rounded-full object-cover mr-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">${user.name}</h2>
                        <p class="text-gray-600">${user.email}</p>
                    </div>
                `;

                const buttonsContainer = document.getElementById('student-profile-buttons');
                buttonsContainer.innerHTML = `
                    <button class="bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition-colors shadow-md" onclick="showTraining('A')">
                        Treino A
                    </button>
                    <button class="bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition-colors shadow-md" onclick="showTraining('B')">
                        Treino B
                    </button>
                    <button class="bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors shadow-md" onclick="showEvolution()">
                        Evolução
                    </button>
                    <button class="bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors shadow-md" onclick="showWeightControl()">
                        Controle de Peso
                    </button>
                    <button class="bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition-colors shadow-md" onclick="showRunningWorkouts()">
                        Treinos de Corrida
                    </button>
                    <button class="bg-yellow-600 text-white font-bold py-3 rounded-lg hover:bg-yellow-700 transition-colors shadow-md" onclick="showPeriodization()">
                        Periodização
                    </button>
                `;
            }

            function populateWeightControlScreen(email) {
                const weightData = database.trainingPlans[email]?.weight || [];
                
                // Atualizar gráfico
                const ctx = document.getElementById('weightChart').getContext('2d');
                
                // Destruir gráfico existente se houver
                if (window.weightChart && typeof window.weightChart.destroy === 'function') {
                    window.weightChart.destroy();
                }
                
                window.weightChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: weightData.map(w => new Date(w.date).toLocaleDateString('pt-BR')),
                        datasets: [{
                            label: 'Peso (kg)',
                            data: weightData.map(w => w.value),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Peso (kg)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Data'
                                }
                            }
                        }
                    }
                });

                // Atualizar histórico
                const historyList = document.getElementById('weight-history-list');
                historyList.innerHTML = '';
                
                const sortedWeights = [...weightData].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedWeights.forEach((weight, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                    
                    const difference = index < sortedWeights.length - 1 ? 
                        (weight.value - sortedWeights[index + 1].value).toFixed(1) : null;
                    
                    let differenceText = '';
                    if (difference !== null) {
                        const sign = difference > 0 ? '+' : '';
                        const color = difference > 0 ? 'text-red-600' : 'text-green-600';
                        differenceText = `<span class="${color} text-sm">(${sign}${difference} kg)</span>`;
                    }
                    
                    historyItem.innerHTML = `
                        <div>
                            <span class="font-semibold">${weight.value} kg</span>
                            ${differenceText}
                        </div>
                        <span class="text-gray-600 text-sm">${new Date(weight.date).toLocaleDateString('pt-BR')}</span>
                    `;
                    historyList.appendChild(historyItem);
                });
            }

            // Funções globais para os botões
            window.showTraining = function(type) {
                showScreen('trainingScreen');
            };

            window.showEvolution = function() {
                showScreen('evolutionScreen');
            };

            window.showWeightControl = function() {
                const user = database.users.find(u => u.id === currentStudentId);
                if (user) {
                    populateWeightControlScreen(user.email);
                    showScreen("weightControlScreen");
                }
            };

            window.showRunningWorkouts = function() {
                const user = database.users.find(u => u.id === currentStudentId);
                if (user) {
                    populateRunningWorkoutsScreen(user.email);
                    showScreen("runningWorkoutsScreen");
                }
            };

            window.showPeriodization = function() {
                const user = database.users.find(u => u.id === currentStudentId);
                if (user) {
                    populatePeriodizationScreen(user.email);
                    showScreen("periodizationScreen");
                }
            };

            function populateRunningWorkoutsScreen(email) {
                const runningWorkouts = database.trainingPlans[email]?.runningWorkouts || [];
                const container = document.getElementById("running-workouts-list");
                container.innerHTML = "";

                if (runningWorkouts.length === 0) {
                    container.innerHTML = 
                        `<p class="text-gray-600 text-center">Nenhum treino de corrida registrado para este aluno.</p>`;
                    return;
                }

                runningWorkouts.forEach(workout => {
                    const workoutItem = document.createElement("div");
                    workoutItem.className = "bg-white p-4 rounded-lg border border-gray-200 shadow-sm";
                    workoutItem.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-lg text-gray-800">${workout.type}</h3>
                            <span class="text-sm text-gray-600">${new Date(workout.date).toLocaleDateString("pt-BR")}</span>
                        </div>
                        <p class="text-gray-700 mb-1">Distância: ${workout.distance} km</p>
                        <p class="text-gray-700 mb-1">Duração: ${workout.duration}</p>
                        <p class="text-gray-700 mb-2">Pace Médio: ${workout.avgPace}</p>
                        <div class="flex items-center">
                            <input type="checkbox" ${workout.completed ? "checked" : ""} disabled
                                class="form-checkbox h-5 w-5 text-red-600 rounded focus:ring-red-500">
                            <span class="ml-2 text-gray-700">Concluído</span>
                        </div>
                    `;
                    container.appendChild(workoutItem);
                });
            }

            function populatePeriodizationScreen(email) {
                const periodizationData = database.trainingPlans[email]?.periodization || [];
                const container = document.getElementById("periodization-list");
                container.innerHTML = "";

                if (periodizationData.length === 0) {
                    container.innerHTML = 
                        `<p class="text-gray-600 text-center">Nenhuma periodização registrada para este aluno.</p>`;
                    return;
                }

                periodizationData.forEach(period => {
                    const periodItem = document.createElement("div");
                    periodItem.className = "bg-white p-4 rounded-lg border border-gray-200 shadow-sm";
                    periodItem.innerHTML = `
                        <h3 class="font-bold text-lg text-gray-800 mb-2">${period.month} ${period.year}</h3>
                        <p class="text-gray-700 mb-1">Foco: ${period.focus}</p>
                        <p class="text-gray-600 text-sm">${period.details}</p>
                    `;
                    container.appendChild(periodItem);
                });
            }

            // Event listeners
            document.getElementById('save-weight-btn').addEventListener('click', () => {
                const weightInput = document.getElementById('weight-input');
                const newWeight = parseFloat(weightInput.value);
                const user = database.users.find(u => u.id === currentStudentId);

                if (newWeight > 0 && user) {
                    const today = new Date().toISOString().split('T')[0];
                    
                    // Inicializar estrutura se não existir
                    if (!database.trainingPlans[user.email]) {
                        database.trainingPlans[user.email] = { weight: [] };
                    } else if (!database.trainingPlans[user.email].weight) {
                        database.trainingPlans[user.email].weight = [];
                    }
                    
                    // Adicionar novo peso
                    database.trainingPlans[user.email].weight.push({ 
                        date: today, 
                        value: newWeight 
                    });
                    
                    // Limpar input
                    weightInput.value = '';
                    
                    // Atualizar tela
                    populateWeightControlScreen(user.email);
                    
                    // Feedback visual
                    const saveBtn = document.getElementById('save-weight-btn');
                    const originalText = saveBtn.textContent;
                    saveBtn.textContent = 'Salvo!';
                    saveBtn.classList.add('bg-green-600');
                    saveBtn.classList.remove('bg-red-600');
                    
                    setTimeout(() => {
                        saveBtn.textContent = originalText;
                        saveBtn.classList.remove('bg-green-600');
                        saveBtn.classList.add('bg-red-600');
                    }, 1500);
                } else {
                    alert('Por favor, insira um peso válido.');
                }
            });
            
            document.querySelectorAll('.back-to-list-btn').forEach(btn => 
                btn.addEventListener('click', () => showScreen('studentListScreen'))
            );
            
            document.querySelectorAll('.back-to-profile-btn').forEach(btn => 
                btn.addEventListener('click', () => {
                    populateStudentProfile(currentStudentId);
                    showScreen('studentProfileScreen');
                })
            );

            // Inicialização
            initializeDatabase();
            showScreen('studentListScreen');
            populateStudentList();
        }

        document.addEventListener('DOMContentLoaded', mainApp);
    </script>
</body>
</html>
